doctype html
html
  head
    meta(charset='UTF-8')
    title= '统计管理'
    link(href="/stylesheets/jquery-ui-1.8.16.custom.css" rel="stylesheet" type="text/css")
    link(href="/javascripts/jtable/themes/lightcolor/blue/jtable.css" rel="stylesheet" type="text/css")
    link(href="/javascripts/validationEngine/css/validationEngine.jquery.css" rel="stylesheet" type="text/css")

    script(src="/javascripts/jquery-1.6.4.min.js" type="text/javascript")
    script(src="/javascripts/jquery-ui-1.8.16.custom.min.js" type="text/javascript")
    script(src="/javascripts/jtable/jquery.jtable.js" type="text/javascript")
    script(src="/javascripts/validationEngine/js/jquery.validationEngine.js" type="text/javascript")
    script(src="/javascripts/validationEngine/js/languages/jquery.validationEngine-zh_CN.js" type="text/javascript")
  body(style='text-align:center;')
    div(style='background-color:#EAEAEA;width:1300px;color:#858585;height:22px;margin:auto;')
      a(href='/users',style='text-decoration:none;color:rgb(75,133,191);')
        用户管理
      &nbsp;|&nbsp; 
      a(href='/daily',style='text-decoration:none;color:rgb(75,133,191);')
        统计管理
      &nbsp;|&nbsp; 
      a(href='/game',style='text-decoration:none;color:rgb(75,133,191);')
        游戏管理
      &nbsp;|&nbsp;
      a(href='/project',style='text-decoration:none;color:rgb(75,133,191);')
        项目管理
      &nbsp;|&nbsp;
      a(href='/vendor',style='text-decoration:none;color:rgb(75,133,191);')
        供应商管理
    div(id='myDiv' style="width: 1300px;margin:auto;")
    script(type="text/javascript").
      $(document).ready(function () {
        //Prepare jTable
        $('#myDiv').jtable({
          title: '统计',
          //- paging: true, //Enable paging
          //- pageSize: 5, //Set page size (default: 10)
          //- sorting: true, //Enable sorting
          //- defaultSorting: 'username ASC', //Set default sorting
          actions: {
            listAction: 'daily/list',
            createAction: 'daily/create',
            updateAction: 'daily/update',
            deleteAction: 'daily/delete'
          },
          fields: {
            id: {
              key: true,
              create: false,
              edit: false,
              list: false
            },
            projectid: {
              //- key: true,
              title: '项目编号',
              width: '20%',
              options: 'daily/get_project_options'
            },
            date: {
              title: '日期',
              width: '20%',
              type: 'date',
              displayFormat: 'yy-mm-dd'
            },
            income: {
              title: '收入',
              width: '20%'
            },
            activate: {
              title: '激活用户',
              width: '20%'
            },
            newplayer: {
              title: '新用户',
              width: '20%'
            }
          },
          //Initialize validation logic when a form is created
          formCreated: function (event, data) {
              data.form.find('input[name="projectid"]').addClass('validate[required]');
              data.form.find('input[name="date"]').addClass('validate[required]');
              data.form.find('input[name="income"]').addClass('validate[custom[number]]');
              data.form.find('input[name="activate"]').addClass('validate[custom[integer]]');
              data.form.find('input[name="newplayer"]').addClass('validate[custom[integer]]');
              data.form.validationEngine();
          },
          //Validate form when it is being submitted
          formSubmitting: function (event, data) {
              return data.form.validationEngine('validate');
          },
          //Dispose validation logic when form is closed
          formClosed: function (event, data) {
              //- data.form.validationEngine('hide');
              //- data.form.validationEngine('detach');
          }
        });

        //Load person list from server
        $('#myDiv').jtable('load');

      });

    table(style='border: 1px solid #9D9D9D;border-spacing: 0px 30px;border-radius: 5px;width:1300px;position:relative;top:10px;margin:auto;')
      tr
        td
          div(id='mychart_income' style='height: 400px;')
    table(style='border: 1px solid #9D9D9D;border-spacing: 0px 30px;border-radius: 5px;width:1300px;position:relative;top:10px;margin:auto;')
      tr
        td
          div(id='mychart_activate' style='height: 400px;')
    table(style='border: 1px solid #9D9D9D;border-spacing: 0px 30px;border-radius: 5px;width:1300px;position:relative;top:10px;margin:auto;')
      tr
        td
          div(id='mychart_newplayer' style='height: 400px;')
    script(src="http://echarts.baidu.com/build/dist/echarts.js")
    script(type="text/javascript").
      function ajaxRequest(url, chartType, func){
        var xmlhttp;
        if (window.XMLHttpRequest)
        {// code for IE7+, Firefox, Chrome, Opera, Safari
          xmlhttp=new XMLHttpRequest();
        }
        else
        {// code for IE6, IE5
          xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange=function()
        {
        if (xmlhttp.readyState==4 && xmlhttp.status==200)
          {
            func(eval ("(" + xmlhttp.responseText + ")"));
          }
        }
        xmlhttp.open("POST",url,true);
        xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
        xmlhttp.send("chartType="+chartType);
      }
      // 路径配置
      require.config({
          paths: {
              echarts: 'http://echarts.baidu.com/build/dist'
          }
      });
      // 使用
      require(
          [
              'echarts',
              'echarts/chart/bar', // 使用柱状图就加载bar模块，按需加载
              'echarts/chart/line'
          ],
          function (ec) {

              ajaxRequest('daily/get_charts_option',"income",function(option){
                var myChart = ec.init(document.getElementById('mychart_income')); 
                myChart.setOption(option); 
              });

              ajaxRequest('daily/get_charts_option',"activate",function(option){
                var myChart = ec.init(document.getElementById('mychart_activate')); 
                myChart.setOption(option); 
              });

              ajaxRequest('daily/get_charts_option',"newplayer",function(option){
                var myChart = ec.init(document.getElementById('mychart_newplayer')); 
                myChart.setOption(option); 
              });
              
              // 为echarts对象加载数据 
              //- myChart.setOption(option); 
          }
      );